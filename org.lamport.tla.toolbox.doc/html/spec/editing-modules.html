<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- This is file org.lamport.tla.toobox.doc/html/spec/editing-modules.html -->
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <LINK href="../style.css" rel="stylesheet" type="text/css">

<title>Editing Modules</title>
</head>
<!-- a comment -->

<body>
<h1>Editing Modules</h1>
<pre>
Contents
  <a href="#module">Module Editors</a>
  <a href="#finding">Finding Definitions and Declarations and Their Uses</a>
  <a href="#finding-pcal">Finding PlusCal Source Code</a>
  <a href="#comments">Editing Comments</a>
  <a href="#proofs">Editing and Viewing Proofs</a>
  <a href="#key-bindings">Module Editor Key Bindings</a>

</pre>
<h2><a name="module">Module Editors</a></h2>
 <P> 
When you first open a spec, the Toolbox shows the root module in a module editor view.&nbsp;  
You can open additional modules in separate module editor views by clicking&nbsp; <samp>File/Open Module</samp>.&nbsp;
This will allow you to select a module, either from a list of modules that are or were part of the spec
or from a file browser.&nbsp;  You can also create a new module file in the file browser.&nbsp;  You can select a module
only from the same folder as the root-module file.
</P>

<p>
If you have multiple module editors open, you can switch between them by clicking on the
editor's tab.&nbsp;  A&nbsp; <samp>*</samp>&nbsp; in the tab means that there are unsaved changes
to the module.&nbsp;
Clicking on the&nbsp; <samp>X</samp>&nbsp; at the right of the tab deletes the module editor (but
not the module).&nbsp;  If you accidentally delete a module editor, you can re-open the module as
described above.
</p>
<p>
 It's sometimes useful to open two views on the same module, so you can view different parts of it
at the same time.&nbsp;  You can do this by right-clicking on the module editor's tab and selecting&nbsp; 
<samp>New Editor</samp>.&nbsp;  See the <a href="../gettingstarted/views.html">Managing Views</a> help page
for how to put model editors where you want them in the Toolbox window.&nbsp;  See the 
<a href="pretty-printing.html">Pretty-Printing Modules</a> help page for how to view the pretty-printed
versions of your modules.
</p>

<p>A module editor provides the usual text editing commands for editing the module.&nbsp;
There are&nbsp; 
<samp>Save</samp>&nbsp; and&nbsp;  <samp>Save As</samp>&nbsp; commands on the &nbsp;  <samp>File</samp>&nbsp;
menu.&nbsp;  (Typing&nbsp; <code>Control+s</code>&nbsp; also performs the save command.)&nbsp;  The&nbsp;  <samp>Edit</samp>&nbsp;
menu provides a few familiar commands.&nbsp;  
<a href="#key-bindings">Below</a> is a list of available commands and the keys to which they are bound.&nbsp;

</p>

<p>
If you create a new module file with the Toolbox, the module editor will create
a modification history at the end of the file that begins with the line
<pre>
   \* Modification History   
</pre>
You can move the modification history anywhere you want in the file.&nbsp;

If you created the file outside the Toolbox, you can put this history-beginning
line anywhere you want.&nbsp;

However, the line must appear exactly as shown, with no spaces before
the &nbsp;<code>\*</code>&nbsp; and exactly one space after it.
</p>

<h2><a name="finding">Finding  Definitions,  Declarations, and Their Uses</a></h2>
<p>
The module editor provides commands for finding the PlusCal code that 

finding the definition or declaration of a user-defined symbol, 
for finding all uses of that definition or declaration, and for finding all symbols defined and declared 
in the module.&nbsp; 


For brevity, the names of all of these commands use the term <em>declaration</em> instead of <em>declaration
or definition</em>.

These commands can be executed by right-clicking on the editor and selecting the command from the
popped-up menu, or with the keystroke indicated on the menu.&nbsp;  

The <samp>General/Keys</samp> item on
the <a href="../gettingstarted/preferences.html">Preference</a> menu allows you to change those
key bindings.&nbsp; 

The <em>Goto Declaration</em>
command can also be executed by <em>control + click</em>, as explained below.  
</p>

<p>
For the commands that find the declaration or uses of a symbol, the symbol is the one containing the cursor (caret) 
or that the cursor is right before.&nbsp;  

It is not the one being pointed at by the mouse--except when using the <em>control + click</em> version of
the <em>Goto Declaration</em> command.
</p> 

<p>
Most of these commands work only if the spec is successfully parsed--that is, if its status (indicated at the bottom 
of the window) is <em>parsed</em> (green).&nbsp;

If the module has been modified since the spec was parsed, a command may not work properly.  The <em>Goto Declaration</em>
command may not recognize the symbol, and a command that should highlight and/or jump to someplace in the module may highlight
or jump to the wrong place.&nbsp;

However, if the <em>Show Uses</em> command is executed before the module is modified, then the highlighting and subsequent
<em>Goto Prev/Next Use</em> commands will work properly.
</p>

<h3>Goto Declaration (F3)</h3>

<p>
This command jumps to the definition or declaration of the chosen symbol, which must not be a built-in TLA+ symbol or
a symbol defined in a standard module.&nbsp;  

This could mean jumping to a different module.&nbsp;  

In addition to executing the command from a menu or by typing <code>F3</code>, you can also hold down the <code>Control</code> key
and move the mouse over the symbol.&nbsp;  

When the mouse is over a declared or user-defined symbol, the symbol will change appearance and turn into
a link that you can left-click on to jump to the symbol's declaration or definition.
</p>


<h3>Return From Goto (F4)</h3>

This command jumps back to the location from which the most recent <em>Goto Declaration</em> 
or <em>Goto PCal Source</em> command was executed.

<h3>Show Declarations (F5)</h3>

<p>
This command raises a menu containing a list of all the symbols defined and declared in the current module.&nbsp;

You can jump to a symbol's definition or declaration by selecting that symbol from the list.&nbsp;

You can select an item from the list by clicking on it, or by selecting the desired item--with a combination of the
arrow keys and typing the first few letters of its name--and then typing <code>Enter</code>.&nbsp;
</p>

<p>Typing <code>space</code> causes the menu to toggle between showing and hiding definitions that are
imported by instantiation.&nbsp;  

(More precisely, it applies to definitions that are imported with renaming and/or with substitution
for module parameters.)
</p>

<h3><a name ="showUses">Show Uses (F6)</a></h3>
<p>
This command highlights all uses of the selected symbol and enables the <em>Goto Next Use</em>
and <em>Goto Prev Use</em> commands.&nbsp;  

If the symbol is used in more than one module, it
raises a menu allowing you to select the desired module from a list.&nbsp;  

You can select a module from the list by clicking on it, or by selecting it--with a combination of the
arrow keys and typing the first few letters of its name--and then typing <code>Enter</code>.
</p>
<p>
The highlighting of the uses is cleared by executing another <em>Show Uses</em> command or by re-parsing
the specification.&nbsp;  

Whether or not re-parsing the specification  clears the highlighting is controlled by an editor
<a href="../gettingstarted/preferences.html">preference</a>.
</p>

<h3>Goto Prev/Next Use (F7/F8)</h3>

These commands jump to the previous or next (earlier or later in the module) use of the
symbol selected by the most recent <em>Show Uses</em> command.

<h2><a name="finding-pcal">Finding PlusCal Source Code</a></h2>

<p>
After you have successfully run the PlusCal translator to translate an algorithm,
the <em>Goto PCal Source</em> command (F10) allows you to jump from a selected region of
the TLA+ translation to the PlusCal code that generated it.&nbsp;  Select a
region of the TLA+ specification, and the command jumps to and highlights approximately
the smallest syntactic unit of the PlusCal algorithm whose translation contains the
selected region.&nbsp;  (You can select a single token by putting the cursor in or
next to it.)&nbsp;  The command does nothing if that smallest syntactic unit is
the entire algorithm, or if the selected region does not lie within the algorithm's
translation.  The <em>Return From Goto</em> command (F4) jumps back to the original
selection.&nbsp; 
</p>

<p>
Clicking on parsing error reports, and on error reports and some other 
fields in a TLC model window, highlights and jumps to a region of the
TLA+ spec.&nbsp;  If that region of the spec was produced by the PlusCal
translation, the <em>Goto PCal Source</em> should then take you to the
appropriate part of the PlusCal source code.&nbsp;  We expect that
in a future release, you will be able to go directly to the PlusCal source
with just a click.

</p>

<p>
The mapping from regions of the TLA+ translation to regions of the PlusCal source 
is determined at the time of translation.&nbsp;  If the PlusCal source, the
translation, or any part of the module lying between them is changed, then the
command may jump to the wrong place.&nbsp;  It's best to put the translation immediately
after the comment containing the algorithm.&nbsp;  If you omit the 
<code>BEGIN/END TRANSLATION</code> comments, that is where the translation will be 
put.
</p>

<h2><a name="comments">Editing Comments</a></h2>

<p>
The <a href="pretty-printing.html">TLA+ Pretty Printer</a> regards
a comment "boxed" as follows to be a sequence of paragraphs.
<pre>
  (**************************************)
  (* This is the                        *)
  (*   first paragraph.                 *)
  (*                                    *)
  (*   This text is a display           *)
  (*                                    *)
  (* This is another paragraph.         *)
  (**************************************)
</pre>
Such a box can be placed on a series of lines by itself, or
it can appear to the right of other text.&nbsp;
</p>

<p>
The module editor provides the commands for creating and
editing boxed comments.&nbsp;  

They make boxed comments that extend from some specified point to a right
margin--a column specified by a 
<a href="../gettingstarted/module-editor-preferences.html">preference.</a>.&nbsp; 

These commands are executed by typing two characters, the first of
which is <samp>Ctl+O</samp>.&nbsp; 

If you type <samp>Ctl+O</samp> and wait a moment, the list of all these
commands will appear.&nbsp;

The commands can also be executed by right-clicking on the mouse.&nbsp;

For these commands, the <em>current position</em> is the location where
the typing cursor is, not where the mouse is pointing.&nbsp;
</p>

<p>
To create a comment, you first position cursor where you
want the top left-hand corner of the comment and execute the
<em>Start Boxed Comment</em> by typing <samp>Ctl+O Ctl+S</samp>.&nbsp;

This produces the comment begin and end tokens like this:
<pre>
Beauty == TRUE  (***********************************

                ***********************************)</pre>
showing where the finished box will be positioned, and it leaves the cursor
between them in the first column.&nbsp;

Type your comment like ordinary text, with all paragraph lines
starting in column 1, like this:

<pre>
Beauty == TRUE  (***********************************
This is 
a
very interesting formula, 
because it expresses Keats' famous dictum

  Beauty is truth
  and truth beauty.
         
How much more than this do you really need to know?
               ***********************************)</pre>
When you have finished the contents of the comment, execute
the <em>Format Comment</em> command by typing 
<samp>Ctl+O Ctl+F</samp>.&nbsp;

This will format each sequence of non-blank lines that all begin in column 1
as a paragraph, with lines broken so the paragraphs will fit snugly in the
comment box--like this:&nbsp;

<pre>
Beauty == TRUE  (***********************************
This is a very interesting 
formula, because it expresses
Keats' famous dictum

  Beauty is truth
  and truth beauty.
         
How much more than this do you 
really need to know?
               ***********************************)</pre>


Note that lines that do not begin in column 1 are not changed.&nbsp;

If it looks right, execute the <em>Box Comment</em> command by
typing <samp>Ctl+O Ctl+B</samp> to create the box, like this:

<pre>
Beauty == TRUE  (**********************************)
                (* This is a very interesting     *)
                (* formula, because it expresses  *)
                (* Keats' famous dictum           *)
                (*                                *)
                (*   Beauty is truth              *)
                (*   and truth beauty.            *)
                (*                                *)
                (* How much more than this do you *)
                (* really need to know?           *)
                (**********************************)</pre>



If the result doesn't look right, type <samp>Ctl+Z</samp> to undo the <em>Box
Comment</em> command and do whatever manual formatting seems necessary.&nbsp;
Then execute <em>Box Comment</em> again.&nbsp;

Both the formatting and the boxing can be done together with the
<em>Format and Box Comment</em> command by typing <samp>Ctl+O Ctl+O</samp>.

</p>

<p>
To modify an existing boxed comment, put the cursor inside the
comment box and execute the <em>Unbox Comment</em> command
by typing <samp>Ctl+O Ctl+U</samp>.&nbsp;  You can then edit and
rebox it with the commands described above.  
</p>


<h2><a name="proofs">Editing and Viewing Proofs</a></h2>

Editor commands for hierarchically viewing proofs are
described in <a href="../prover/reading.html">Viewing Structured Proofs</a>.&nbsp;

The module editor will eventually provide commands to aid in writing
and editing proofs.&nbsp;  

We would appreciate any suggestions for what commands we should
implement.&nbsp;

<h2><a name="key-bindings">Module Editor Key Bindings</a></h2>

The following are the default key bindings for module editors.&nbsp;  The <samp>General/Keys</samp> item on
the <a href="../gettingstarted/preferences.html">Preference</a> menu allows you to change those
key bindings.&nbsp;  Its <em>Emacs</em> scheme  binds a few commands to the keys used in the
Emacs editor, making the module editor almost, but not quite, completely unlike Emacs. <br></br>

<TABLE frame=box rules=all>
       <!-- style="font-style:italic;font-size:80%"  -->
<!-- <CAPTION align=left><h3>Module Editor Key Bindings</h3></CAPTION> -->
<TBODY>
<COL align=left> <!-- style="font-family:consolas,courier"--> 
<col align=left >
<TR> <TH colspan=2 align=left> <font color=000000>
Insert, Delete, and Move Text</font></TH>
<TR> <TD><CODE>Ctl+Shift+Enter</CODE></TD> <TD> Insert line above current line</TD></TR>

<TR> <TD><CODE>Shift+Enter</CODE></TD> <TD> Insert line below current line</TD></TR>

<TR> <TD><CODE>Ctl+Shift+Del</CODE></TD> <TD> Delete to end of current line</TD></TR>

<TR> <TD><CODE>Ctl+Backspace</CODE></TD> <TD> Delete to beginning of current or previous word</TD></TR>

<TR> <TD><CODE>Ctl+Del</CODE></TD> <TD> Delete to end of current word</TD></TR>

<TR> <TD><CODE>Alt+Up/DownArrow</CODE></TD> <TD> Move current line up/down</TD></TR>

<TR> <TD><CODE>Shift+Tab</CODE></TD> <TD>If there are (at least) 4 spaces at beginning of line,
                                         delete them</TD></TR>

<TR> <TD><CODE>Ctl+/</CODE></TD> <TD>Comment out or uncomment selected lines</TD></TR>

<TR> <TD><CODE>Ctl+Alt+J</CODE></TD> <TD> Join next line to current line</TD></TR>

<TR><TD><CODE>Ctl+C</CODE></TD> <TD> Copy selected text</TD></TR>

<TR><TD><CODE>Ctl+V</CODE></TD> <TD> Paste</TD></TR>

<TR><TD><CODE>Ctl+Z</CODE></TD> <TD> Undo</TD></TR>

<TR><TD><CODE>Ctl+A</CODE></TD> <TD> Select all</TD></TR>



<TR> <TD colspan=2> <BR> </TD></TR>
<TR> <TH colspan=2 align=left> <font color=000000>Moving Around</font></TH>
<TR> <TD colspan=2 align=left>For most of these commands, holding Shift down also selects the text.</TD>

<TR> <TD><CODE>Home/End</CODE></TD> <TD> Go to beginning/end of current line</TD></TR>

<TR> <TD><CODE>Ctl+Home/End</CODE></TD> <TD> Go to beginning/end of module</TD></TR>

<!-- 
<TR> <TD><CODE>Home</CODE></TD> <TD> Go to beginning of current line</TD></TR>
<TR> <TD><CODE>Ctl+Home</CODE></TD> <TD> Go to beginning of module</TD></TR>
 -->
 
<TR> <TD><CODE>Ctl+RightArrow</CODE></TD> <TD> Go to beginning of next word</TD></TR>

<TR> <TD><CODE>Ctl+LeftArrow</CODE></TD> <TD> Go to beginning of current or previous word</TD></TR>

<TR> <TD><CODE>Ctl+L</CODE></TD> <TD> Go to line [asks for line number]</TD></TR>

<TR> <TD><CODE>Ctl+Q</CODE></TD> <TD> Go to last edit location</TD></TR>


<TR> <TD><CODE>Ctl+Up/DownArrow</CODE></TD> <TD> Scroll up/down one line</TD></TR>
<TR> <TD colspan=2 align=left>The arrow and page-up/down keys behave as usual.</TD>

<!-- 
<TR> <TD colspan=2> <BR> </TD></TR>
<TR> <TH colspan=2 align=left> <font color=000000>Selecting Text</font></TH>
-->

<TR> <TD colspan=2> <BR> </TD></TR>

<TR> <TH colspan=2 align=left> <font color=000000>Find and Replace</font></TH>
<TR> <TD><CODE>Ctl+F</CODE></TD> <TD> Raise Find/Replace dialog</TD></TR>

<TR> <TD><CODE>Ctl+K</CODE></TD> <TD> Find next (in forward direction) instance of last search item</TD></TR>

<TR> <TD><CODE>Ctl+Shift+K</CODE></TD> <TD> Find previous (in backwards direction) instance of last search item</TD></TR>

<TR> <TD><CODE>Ctl+J</CODE></TD> <TD> Incremental forward find</TD></TR>

<TR> <TD><CODE>Ctl+Shift+J</CODE></TD> <TD> Incremental backwards find</TD></TR>



<TR> <TD colspan=2> <BR> </TD></TR>

<TR> <TH colspan=2 align=left> <font color=000000><a href="#finding">Finding Definitions and Declarations and Their Uses</a></font></TH>
<TR> <TD><CODE>F3</CODE></TD> <TD> Goto declaration or definition</TD></TR>
<TR> <TD><CODE>F4</CODE></TD> <TD> Return from goto declaration or definition</TD></TR>
<TR> <TD><CODE>F5</CODE></TD> <TD> Show declarations and definitions</TD></TR>
<TR> <TD><CODE>F6</CODE></TD> <TD> Show uses of declaration or definition</TD></TR>
<TR> <TD><CODE>F7</CODE></TD> <TD> Goto previous use of declaration or definition</TD></TR>
<TR> <TD><CODE>F7</CODE></TD> <TD> Goto next use of declaration or definition</TD></TR>

<TR> <TD colspan=2> <BR> </TD></TR>

<TR> <TH colspan=2 align=left> <font color=000000><a href="#comments">Editing Comments</a></font></TH>
<TR> <TD><CODE>Ctl+O Ctl+S</CODE></TD> <TD> Begin comment</TD></TR>

<TR> <TD><CODE>Ctl+O Ctl+F</CODE></TD> <TD>Format comment</TD></TR>

<TR> <TD><CODE>Ctl+O Ctl+B</CODE></TD> <TD>Box comment</TD></TR>

<TR> <TD><CODE>Ctl+O Ctl+O</CODE></TD> <TD>Format and box comment</TD></TR>

<TR> <TD><CODE>Ctl+O Ctl+U</CODE></TD> <TD>Unbox comment</TD></TR>

<TR> <TD colspan=2> <BR> </TD></TR>

<TR> <TH colspan=2 align=left> <font color=000000>Viewing Proofs</font></TH>
<TR> <TD><CODE>Ctl+G Ctl+S</CODE></TD> <TD>Show current subtree</TD></TR>

<TR> <TD><CODE>Ctl+G Ctl+H</CODE></TD> <TD>Hide current subtree</TD></TR>

<TR> <TD><CODE>Ctl+G Ctl+C</CODE></TD> <TD>Show children only</TD></TR>

<TR> <TD><CODE>Ctl+G Ctl+F</CODE></TD> <TD>Focus on step</TD></TR>

<TR> <TD><CODE>Ctl+G Ctl+A</CODE></TD> <TD>Show all proofs</TD></TR>
<TR> <TD><CODE>Ctl+G Ctl+N</CODE></TD> <TD>Hide all proofs</TD></TR>

<TR> <TD colspan=2> <BR> </TD></TR>

<TR> <TH colspan=2 align=left> <font color=000000>Other</font></TH></TR>



<TR> <TD><CODE>Ctl+S</CODE></TD> <TD> Save module</TD></TR>

<TR> <TD><CODE>Alt+X</CODE></TD> <TD> Exit toolbox</TD></TR>

<TR> <TD><CODE>Ctl+M</CODE></TD> <TD> Maximize or unmaximize current editor or view</TD></TR>

<TR> <TD><CODE>Ctl+R</CODE></TD> <TD> Parse module</TD></TR>

<TR> <TD><CODE>Ctl+Alt+R</CODE></TD> <TD> Parse spec</TD></TR>

<TR> <TD><CODE>F1</CODE></TD> <TD> Raise Help view</TD></TR>

<TR> <TD><CODE>Ctl+PageUp/Down</CODE></TD> <TD> Go to previous/next editor view </TD></TR>

<TR> <TD><CODE>Ctl+F6</CODE></TD> <TD> Go to another editor view  (Use up/down arrow to select view, 
  then type Enter.)</TD></TR>

<TR> <TD><CODE>Ctl+F7</CODE></TD> <TD> Go to another view  (Use up/down arrow to select view, 
  then type Enter.)</TD></TR>
  
  <TR> <TD><CODE>Ctl+F10</CODE></TD> <TD>Can use to set line-numbering preference or go to&nbsp; 
     <samp>Preferences /General/Editors/Text Editors</samp></TD></TR>
  
  


<!-- 
<TR> <TD><CODE>Ctl+Shift+R</CODE></TD> <TD> Open Resource.  <BR>
         This can open a resource from a different spec.
     It should be disabled.

<TR> <TD><CODE>Alt+Shift+N</CODE></TD> <TD> DOES NOTHING</TD></TR>

<TR> <TD><CODE>Ctl+.</CODE></TD> <TD> Seems to do nothing</TD></TR>

<TR> <TD><CODE>Ctl+F</CODE></TD> <TD> Next Editor</TD></TR>

<TR> <TD><CODE>Ctl+F</CODE></TD> <TD> Next Page</TD></TR>

<TR> <TD><CODE>Ctl+Shift+F</CODE></TD> <TD> Previous Page</TD></TR>

<TR> <TD><CODE>Ctl+Shift+F</CODE></TD> <TD> Previous Editor</TD></TR>

<TR> <TD><CODE>Ctl+,</CODE></TD> <TD> SEEMS TO DO NOTHING</TD></TR>

<TR> <TD><CODE>Ctl+.</CODE></TD> <TD> SEEMS TO DO NOTHING</TD></TR>

<TR> <TD><CODE>Alt+PageDown</CODE></TD> <TD> Next SubTab  (Goes from module tab to pdf tab)</TD></TR>

<TR> <TD><CODE>Alt+PageUp  </CODE></TD> <TD> Previous SubTab DOES NOTHING</TD></TR>
<TR> <TD><CODE>Ctl+N</CODE></TD> <TD> Raises a "New" menu that allows user to do weird things. Probably best to disable this.</TD></TR>

<TR> <TD><CODE>Alt+F4</CODE></TD> <TD> Windows command to kill program.</TD></TR>
-->
</TBODY>
</TABLE>

<hr> 
<!-- delete rest of line to comment out  
<dl>
<dt><b><font color=#0000c0>Topics</font></b></dt>
<dd> <A href=""> TOPIC </A></dd>
<dd> <A href=""> TOPIC </A></dd>
</dl>
 --> 
<!-- delete rest of line to comment out -->
<a href = "spec.html">&uarr; Managing Your Specifications</a>
<!-- --> 
</hr>

 

</body>
</html>